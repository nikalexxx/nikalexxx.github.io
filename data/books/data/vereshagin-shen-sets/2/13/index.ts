import { BookApi } from '@bookbox/preset-web';
import { getCustomElements } from '../../elements.js';

export default (api: BookApi) => {
    const { format, math, label, area } = api;
    const { i, b } = format;

    const {paragraph, theorem, problem, proof, A, X, n} = getCustomElements(api);

    return api.book`
${paragraph`Приложения ординалов`}
В большинстве случаев рассуждения с использованием трансфинитной индукции и ординалов можно заменить ссылкой на ${label.ref('theorem_zorns-lemma')`лемму Цорна`};
при этом рассуждение становится менее наглядным, но формально более простым.
Тем не менее бывают ситуации, когда такая замена затруднительна.
В этом разделе мы приведём два подобных примера.


Первый из них касается ${label.ref('name_borel')`борелевских`} множеств.
(Для простоты мы рассматриваем подмножества действительной прямой.)
Семейство подмножеств называется ${i` ${math`\\sigma`}-алгеброй`}, если оно замкнуто относительно конечных и счётных пересечений и объединений, а также относительно перехода к дополнению.
(Это означает, что вместе с каждым множеством ${A} это семейство содержит его дополнение ${math`\\R \\setminus A`}, и вместе с любыми множествами ${math`A_0, A_1, \\dots`} семейство содержит их объединение ${math`A_0 \\cup A_1 \\cup \\dots`} и пересечение ${math`A_0 \\cap A_1 \\cap \\dots`})
Пример: семейство ${math`P(\\R)`} всех подмножеств прямой, очевидно, является ${math`\\sigma`}-алгеброй.


${theorem`Существует наименьшая ${math`\\sigma`}-алгебра, содержащая все отрезки ${math`[a, b]`} на прямой.`}


${proof.start}
Формально можно рассуждать так: рассмотрим все возможные ${math`\\sigma`}-алгебры, содержащие отрезки.
Их пересечение будет ${math`\\sigma`}-алгеброй, и тоже будет содержать все отрезки.
(Вообще пересечение любого семейства ${math`\\sigma`}-алгебр будет ${math`\\sigma`}-алгеброй — это очевидное следствие определения.)
Эта ${math`\\sigma`}-алгебра и будет искомой.
${proof.end}


Множества, входящие в эту наименьшую ${math`\\sigma`}-алгебру, называют ${i`борелевскими`}.


${problem`
Докажите, что всякое открытое и всякое замкнутое подмножество прямой является борелевским.
(Указание: открытое множество есть объединение содержащихся в нём отрезков с рациональными концами.)
`}


${problem`Докажите, что прообраз любого борелевского множества при непрерывном отображении является борелевским множеством.`}


${problem`
Пусть ${math`f_0, f_1, \\dots`} — последовательность непрерывных функций с действительными аргументами и значениями.
Докажите, что множество точек ${math`x`}, в которых последовательность ${math`f_0(x), f_1(x), \\dots`} имеет предел, является борелевским.
`}


Борелевские множества играют важную роль в ${i`дескриптивной теории множеств`}.
Но мы хотим лишь продемонстрировать использование трансфинитной индукции (которую трудно заменить на лемму Цорна) на примере следующей теоремы:


${theorem`Семейство всех борелевских множеств имеет мощность континуума.`}


${proof.start}
Класс борелевских множеств можно строить постепенно.
Начнём с отрезков и дополнений к отрезкам.
На следующем шаге рассмотрим всевозможные счётные пересечения и объединения уже построенных множеств (отрезков и дополнений к ним).


${problem`Докажите, что при этом получатся (среди прочего) все открытые и все замкнутые подмножества прямой.`}


Далее можно рассмотреть счётные объединения и пересечения уже построенных множеств и т.д.


Более формально, пусть ${math`\\mathcal{B}_0`} — семейство множеств, состоящее из всех отрезков и дополнений к ним.
Определим ${math`\\mathcal{B}_{i+1}`} по индукции как семейство множеств, являющихся счётными объединениями или пересечениями множеств из ${math`\\mathcal{B}_i`}.


Все семейства ${math`\\mathcal{B}_i`} состоят из борелевских множеств (поскольку счётное объединение или пересечение борелевских множеств является борелевским).
Исчерпывают ли они все борелевские множества?
Вообще говоря, нет: если мы возьмём по одному множеству из каждого класса ${math`\\mathcal{B}_i`} для всех ${math`i = 0, 1, 2, \\dots`} и рассмотрим их счётное пересечение, то оно вполне может не принадлежать ни одному из классов.
Поэтому мы рассмотрим класс ${math`\\mathcal{B}_{\\omega}`}, представляющий собой объединение всех ${math`\\mathcal{B}_i`} по всем натуральным ${math`i`}, затем ${math`\\mathcal{B}_{\\omega + 1}`}, ${math`\\mathcal{B}_{\\omega + 2}`} и т.д.
Объединение этой последовательности классов естественно назвать ${math`\\mathcal{B}_{\\omega 2}`} и продолжить построение.


Дадим формальное определение ${math`\\mathcal{B}_{\\alpha}`} для любого ординала ${math`\\alpha`}.
Это делается с помощью трансфинитной рекурсии.
При ${math`\\alpha = \\beta + 1`} элементами класса ${math`\\mathcal{B}_{\\alpha}`} будут счётные объединения и пересечения множеств из класса ${math`\\mathcal{B}_{\\beta}`}.
Если ${math`\\alpha`} — предельный ординал, отличный от ${math`0`}, то класс ${math`\\mathcal{B}_{\\alpha}`} представляет собой объединение всех ${math`\\mathcal{B}_{\\beta}`} по всем ${math`\\beta < \\alpha`}.
(Класс ${math`\\mathcal{B}_0`} мы уже определили.)


Из определения следует, что ${math`\\mathcal{B}_{\\alpha} \\subset \\mathcal{B}_{\\beta}`} при ${math`\\alpha < \\beta`}, так что мы получаем возрастающую цепь классов.
Каждый класс замкнут относительно перехода к дополнению (для начального класса мы об этом позаботились, далее по индукции).
Все классы ${math`\\mathcal{B}_{\\alpha}`} содержатся в классе борелевских множеств, так как мы применяем лишь операции счётного объединения и пересечения, относительно которых класс борелевских множеств замкнут.


Возникает вопрос: как далеко нужно продолжать эту конструкцию?
Оказывается, что достаточно дойти до первого несчётного ординала.


Пусть ${math`\\alef_1`} — наименьший несчётный ординал.
(Это — стандартное для него обозначение.)
Другими словами, ${math`\\alef_1`} есть семейство всех счётных ординалов, упорядоченных отношением ${math`<`} на ординалах.


${b`Лемма`}. Класс ${math`\\mathcal{B}_{\\alef_1}`} замкнут относительно счётных объединений и пересечений и потому содержит все борелевские множества.


Доказательство леммы.
Пусть имеется счётная последовательность множеств ${math`B_0, B_1, \\dots`} , принадлежащих ${math`\\mathcal{B}_{\\alef_1}`}.
Ординал ${math`\\alef_1`} — предельный, и класс ${math`\\mathcal{B}_{\\alef_1}`} является объединением меньших классов.
Поэтому каждое из множеств ${math`B_i`} принадлежит какому-то классу ${math`B_{\\alpha_i}`}, где ${math`\\alpha_i`} — некоторый ординал, меньший ${math`\\alef_1`}, т.е. конечный или счётный ординал.
Положим ${math`\\beta = \\sup_i \\alpha_i`}.
Ординал ${math`\\beta`} есть точная верхняя грань счётного числа счётных ординалов и потому счётен.
В самом деле, рассмотрим ординалы ${math`\\alpha_i`} как начальные отрезки в каком-то большем ординале (например, в ${math`\\alef_1`});
их точная верхняя грань будет объединением счётного числа счётных начальных отрезков и потому будет счётным ординалом.


Теперь первое утверждение леммы очевидно: все ${math`B_i`} лежат в ${math`\\mathcal{B}_{\\beta}`}, а потому их объединение (или пересечение) лежит в ${math`\\mathcal{B}_{\\beta + 1}`} и тем более в ${math`\\mathcal{B}_{\\alef_1}`}
(поскольку ${math`\\beta + 1`} есть счётный ординал и меньше ${math`\\alef_1`}).


Таким образом, класс ${math`\\mathcal{B}_{\\alef_1}`} является ${math`\\sigma`}-алгеброй, содержащей отрезки, и потому содержит все борелевские множества.
Лемма доказана.


Как мы уже отмечали, все классы ${math`\\mathcal{B}_{\\alpha}`} состоят из борелевских множеств, так что класс ${math`\\mathcal{B}_{\\alef_1}`} совпадает с классом всех борелевских множеств.


Что можно сказать про мощность классов?
Класс ${math`\\mathcal{B}_0`} имеет мощность континуума (отрезки задаются своими концами).
Если класс ${math`\\mathcal{B}_{\\alpha}`} имеет мощность континуума, то и следующий класс ${math`\\mathcal{B}_{\\alpha + 1}`} имеет мощность континуума
(каждый его элемент задаётся счётной последовательностью элементов предшествующего класса, а ${math`\\frak{c}^{\\alef_0} = \\frak{c}`}).
Каждый предельный класс есть объединение предыдущих, и пока мы не выходим за пределы счётных ординалов, объединение это будет счётно, а ${math`\\frak{c} \\alef_0 = \\frak{c}`}, так что мы не выходим за пределы континуума.
Наконец, ${math`\\mathcal{B}_{\\alef_1}`} есть объединение несчётного числа предыдущих классов (а именно, ${math`\\alef_1`} классов), но так как ${math`\\alef_1 \\leqslant \\frak{c}`}, то ${math`\\frak{c} \\alef_1 = \\frak{c}`}.


Таким образом, класс ${math`\\mathcal{B}_{\\alef_1}`}, он же класс всех борелевских множеств, имеет мощность континуума.
${proof.end}


Обычно построение борелевских множеств начинается немного иначе.
Именно, на нижнем уровне рассматриваются два класса: открытые и замкнутые множества.
На следующем уровне находятся классы ${math`F_{\\sigma}`} (счётные объединения замкнутых множеств) и ${math`G_{\\delta}`} (счётные пересечения открытых множеств).
Ещё на уровень выше лежат счётные пересечения множеств из ${math`F_{\\sigma}`} и счётные объединения множеств из ${math`G_{\\delta}`}, и т.д.
Такой подход является более естественным с точки зрения топологии, поскольку отрезки на прямой ничем не замечательны.
Можно проверить, что разница между таким подходом и нашим определением невелика.


${problem`
Докажите, что пересечение двух ${math`F_{\\sigma}`}-множеств является ${math`F_{\\sigma}`}-множеством
(и вообще классы ${math`F_{\\sigma}`}, ${math`G_{\\delta}`}, а также классы следующих уровней, замкнуты относительно конечных объединений и пересечений).
`}


${problem`Докажите, что ${math`F_{\\sigma}`}- и ${math`G_{\\delta}`}-множества лежат в классе ${math`\\mathcal{B}_2`} в соответствии с нашей классификацией.`}


${problem`Докажите, что всякое множество класса ${math`\\mathcal{B}_2`} отличается от некоторого ${math`F_{\\sigma}`}- или ${math`G_{\\delta}`}-множества не более чем на счётное множество.`}


${problem`Докажите, что всякое множество класса ${math`\\mathcal{B}_3`} является счётным пересечением ${math`F_{\\sigma}`}-множеств или счётным объединением ${math`G_{\\delta}`}-множеств и что аналогичное утверждение верно для более высоких уровней нашей иерархии.`}


${problem`
Докажите, что существует открытое множество на плоскости, среди вертикальных сечений которого встречаются все открытые подмножества прямой.
Докажите, что существует ${math`G_{\\delta}`}-множество на плоскости, среди сечений которого встречаются все ${math`G_{\\delta}`}-подмножества прямой.
Докажите аналогичные утверждения для следующих уровней.
`}


${problem`
Покажите, что существует ${math`G_{\\delta}`}-множество, не являющееся ${math`F_{\\sigma}`}-множеством.
Покажите, что существует счётное объединение ${math`G_{\\delta}`}-множеств, не являющееся счётным пересечением ${math`F_{\\sigma}`}-множеств и т.д.
(Указание: воспользуйтесь предыдущей задачей.)
`}


Ординалы часто появляются при классификации элементов того или иного множества по «рангам».
Например, можно классифицировать элементы фундированного множества.


${theorem`
Пусть ${X} — фундированное множество.
Тогда существует и единственна функция ${math`\\mathrm{rk}`}, определённая на ${X} и принимающая значения в классе ординалов, для которой
${math.block()`
\\mathrm{rk}(x) = \\min\\{\\alpha \\ | \\ \\alpha > \\mathrm{rk}(y) \\ \\text{для любого} \\ y < x\\}
`}
(при любом ${math`x \\in X`}).
`}


${proof.start}
Определим множество ${math`X_{\\alpha}`} рекурсией по ординалу ${math`\\alpha`}: ${math`X_{\\alpha}`} состоит из всех элементов ${math`x \\in X`}, для которых все меньшие их (в ${X}) элементы принадлежат ${math`X_{\\beta}`} с меньшими индексами ${math`\\beta`}:
${math.block()`
x \\in X_{\\alpha} \\lrArr (\\forall y < x) (\\exists \\beta < \\alpha) (y \\in X_{\\beta}).
`}
Заметим, что здесь (как и в формулировке теоремы) знак ${math`<`} используется в двух разных смыслах: как порядок на ${X} и как порядок на ординалах.


Очевидно, что с ростом ${math`\\alpha`} множество ${math`X_{\\alpha}`} растёт (точнее, не убывает).
Докажем, что при достаточно большом ${math`\\alpha`} множество ${math`X_{\\alpha}`} покрывает всё ${X}.
Если это не так, то из ${math`\\beta < \\gamma`} следует ${math`X_{\\beta} \\subsetneq X_{\\gamma}`}
(произвольный минимальный элемент, не лежащий в ${math`X_{\\beta}`}, принадлежит ${math`X_{\\gamma}`}).
Поэтому отображение ${math`\\alpha \\mapsto X_{\\alpha}`} будет инъекцией, что невозможно
(возьмём ординал, по мощности больший ${math`P(X)`}; предшествующих ему ординалов уже слишком много).


Теперь определим ${math`\\mathrm{rk}(x)`} как минимальное значение ${math`\\alpha`}, для которого ${math`x \\in X_{\\alpha}`}.
Если ${math`\\mathrm{rk}(x) = \\alpha`} и ${math`y < x`}, то ${math`\\mathrm{rk}(y) < \\alpha`}.
(В самом деле, по определению ${math`X_{\\alpha}`} из ${math`x \\in X_{\\alpha}`} и ${math`y < x`} следует, что ${math`y \\in X_{\\beta}`} при некотором ${math`\\beta < \\alpha`}.)
Наоборот, если для некоторого ординала ${math`\\gamma`} выполнено неравенство ${math`\\mathrm{rk}(y) < \\gamma`} при всех ${math`y < x`}, то ${math`\\mathrm{rk}(x) \\leqslant \\gamma`}.
В самом деле, тогда любой элемент ${math`y < x`} принадлежит некоторому ${math`X_{\\beta}`} с ${math`\\beta < \\gamma`}
(положим ${math`\\beta = \\mathrm{rk}(y)`}) и потому ${math`x \\in X_{\\gamma}`} и ${math`\\mathrm{rk}(x) \\leqslant \\gamma`}.


Итак, построенная нами функция ${math`\\mathrm{rk}`} обладает требуемым свойством.
Единственность доказать совсем легко: если есть две такие функции, рассмотрим минимальную точку в ${X}, на которой они различаются, и сразу же получим противоречие.
${proof.end}


В частности, счётные ординалы можно использовать для классификации деревьев, в которых нет бесконечных путей.
Мы будем рассматривать ${i`корневые деревья с конечным или счётным ветвлением`}
(у каждой вершины конечное или счётное число сыновей),
в которых нет бесконечной ветви (последовательности вершин, в которых каждая есть сын предыдущей).


Формально такое дерево можно определить как подмножество ${math`T`} множества ${math`\\N^*`} конечных последовательностей натуральных чисел, замкнутое относительно взятия префикса
(если последовательность принадлежит ${math`T`}, то любой её начальный отрезок принадлежит ${math`T`}).
Элементы множества ${math`T`} мы называем ${i`вершинами`} дерева;
вершина ${math`y`} есть ${i`сын`} вершины ${math`x`}, если ${math`y`} получается из ${math`x`} приписыванием справа какого-то одного числа.
Вершина ${math`y`} является ${i`потомком`} вершины ${math`x`}, если ${math`y`} получается добавлением к ${math`x`} одного или нескольких чисел.


Мы говорим, что в дереве ${math`T`} ${i`нет бесконечной ветви`}, если не существует бесконечной последовательности натуральных чисел, все начала которой принадлежат ${math`T`}.
В этом случае отношение порядка
${math.block()`
y < x \\lrArr y \\ \\text{есть потомок} \\ x
`}
фундировано и можно применить предыдущую теорему, определив ранги всех вершин дерева ${math`T`}.
Ранг его ${i`корня`} (последовательности длины 0) и будем называть ${i`рангом дерева`}.


${theorem.key('tree-rang')`
${area.key('theorem_tree-rang-а')`(${b`а`}) Ранг любого дерева (описанного вида) является счётным ординалом.`}
${area.key('theorem_tree-rang-б')`(${b`б`}) Всякий счётный ординал является рангом некоторого дерева.`}
`}


${proof.start}
${label.ref('theorem_tree-rang-а')`(а)`} Пусть ранг некоторого дерева, то есть ранг его корня, является несчётным ординалом.
Тогда ранг одного из сыновей корня также несчётен.
(В самом деле, точная верхняя грань счётного множества счётных ординалов является счётным ординалом;
это становится ясным, если рассматривать эти ординалы как начальные отрезки большего — тогда точная верхняя грань будет объединением.)
У этого сына в свою очередь есть сын несчётного ранга и т.д.
Этот процесс не может оборваться, и мы получаем бесконечную ветвь в противоречии с предположением.


${label.ref('theorem_tree-rang-б')`(б)`} Это утверждение доказывается индукцией: пусть ${math`\\alpha`} — наименьший счётный ординал, для которого такого дерева нет.
Тогда для всех меньших ординалов деревья есть.
Возьмём эти деревья и сделаем их поддеревьями с общим корнем (их корни станут сыновьями этого общего корня).
Новое дерево также имеет счётное ветвление и ранг его корня равен ${math`\\alpha`}.
${proof.end}


${problem`
Пусть имеется счётное дерево, не имеющее бесконечных ветвей.
Предположим, что в каждом его листе находится отрезок или дополнение до отрезка, а в каждой внутренней вершине стоит знак пересечения или объединения.
Как сопоставить такому дереву некоторое борелевское множество?
(Указание: покажите, что в каждой вершине можно единственным образом написать некоторое множество, согласованное с пометками.)
Покажите, что все борелевские множества могут быть получены таким способом.
`}


Деревья с пометками, рассмотренные в этой задаче, представляют собой как бы бесконечные формулы, составленные из отрезков и дополнений к ним с помощью операций счётного объединения и пересечения
(конечные деревья соответствовали бы конечным формулам).
Можно условно сказать, что борелевские множества — это множества, выражающиеся с помощью таких формул.


${problem`
Докажите, что семейство борелевских множеств имеет мощность континнума, используя «бесконечные формулы» — размеченные деревья, в которых нет бесконечных ветвей.
(Это доказательство обходится без ординалов, трансфинитной индукции и даже леммы Цорна — хотя и использует аксиому выбора.)
`}


В заключение приведём скорее забавный, чем важный, пример использования трансфинитной рекурсии и ординалов.


${theorem`Существует множество точек на плоскости, которое пересекается с каждой прямой ровно в двух точках.`}


Две параллельные прямые почти что удовлетворяют этому требованию (исключением являются лишь параллельные им прямые).
Но избавиться от этого исключения не так просто.


${proof.start}
Требования к множеству можно сформулировать так: никакие три точки не лежат на одной прямой, но любая прямая пересекает его не менее чем в двух точках.


Будем строить это множество трансфинитной рекурсией.
Пусть ${math`\\alpha`} — минимальный ординал, имеющий мощность континуума.
(Если континуум-гипотеза верна, то он совпадает с ${math`\\alef_1`}, но это нам не важно.)
Тогда множество всех меньших ординалов можно поставить во взаимно однозначное соответствие с множеством всех прямых на плоскости.
Пусть ${math`l_{\\beta}`} — прямая, соответствующая ординалу ${math`\\beta < \\alpha`}.


Для каждого ${math`\\beta < \\alpha`} построим множество ${math`M_{\\beta}`}, в котором никакие три точки не лежат на одной прямой, следующим образом.
Объединим все построенные ранее множества ${math`M_{\\gamma}`} при всех ${math`\\gamma < \\beta`}.
Могут ли в этом множестве (обозначим его ${math`T`}) какие-то три точки лежать на одной прямой?
Если да, то эти точки берутся из каких-то множеств ${math`M_{\\gamma_1}, M_{\\gamma_2}, M_{\\gamma_3}`};
возьмём наибольший из ординалов ${math`\\gamma_1, \\gamma_2, \\gamma_3`};
в соответствующем множестве будут три точки, лежащие на одной прямой, что противоречит предположению индукции.


Посмотрим, во скольких точках пересекает прямая ${math`l_{\\beta}`} множество ${math`T`}.
Таких точек (по доказанному) не больше двух.
Если их ровно две, то всё хорошо и мы новых точек не добавляем, считая, что ${math`M_{\\beta} = T`}.
Если их меньше, то мы должны добавить новые точки (до двух), но только так, чтобы при этом не образовалось трёх точек, лежащих на одной прямой.
Другими словами, нельзя добавлять точки, которые лежат на пересечении ${math`l_{\\beta}`} с прямыми, проходящими через пары уже имеющихся точек.


Сколько таких прямых (то есть сколько пар уже имеющихся точек)?
По построению видно, что все уже имеющиеся точки лежат по две на каждой прямой ${math`l_{\\gamma}`} при ${math`\\gamma < \\beta`}.
(Строго говоря, это следует включить в индуктивное предположение.)
Таким образом, множество ${math`T`} по мощности есть ${math`2 \\beta = \\beta`}, а пар точек не больше ${math`\\beta^2 = \\beta < \\frak{c}`}.
Поэтому запрещённые точки составляют лишь малую (по мощности) часть прямой ${math`l_{\\beta}`}, и можно выбрать две разрешённые точки.


Теперь осталось объединить множества ${math`M_{\\beta}`} для всех ординалов ${math`\\beta < \\alpha`} и получить искомое множество.
(По условию три точки на одной прямой в нём появиться не могут, а всякая прямая будет рано или поздно рассмотрена и две точки на ней будут обеспечены.)
${proof.end}


${problem`
Найдите ошибку в следующем «опровержении гипотезы континуума»: пусть ${math`\\alef_1 = \\frak{c}`}.
Упорядочим отрезок ${math`[0, 1]`} по типу ${math`\\alef_1`}.
Рассмотрим функцию двух переменных, равную единице на паре ${math`(x, y)`}, если ${math`x < y`} (в смысле этого порядка), и нулю в остальных случаях.
Тогда при фиксированном ${math`x`} функия ${math`y \\mapsto f(x, y)`} равна единице везде, кроме счётного множества, и потому интегрируема и ${math`\\int f(x, y) dy = 1`} при любом ${math`x`}.
С другой стороны, функция ${math`x \\mapsto f(x, y)`} равна нулю всюду, кроме счётного множества, так что ${math`\\int f(x, y) dx = 0`}.
Получаем противоречие с теоремой ${label.ref('name_fubini')`Фубини`}, которая утверждает, что
${math.block()`
\\int_0^1\\left(\\int_0^1 f(x, y)\\,dy\\right)\\,dx = \\int_0^1\\left(\\int_0^1 f(x, y)\\,dx\\right)\\,dy.
`}
`}
`;
};
